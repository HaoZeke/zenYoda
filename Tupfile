# The build tool.
# Copyright (C) 2017  Rohit Goswami

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.


# Variables
# Pandoc location
pandocBinary=$HOME/.local/bin/pandoc
## Output Directories
### Beamer
beamerOut=dist/pres/beamer
### html
htmlPresOut=dist/pres/html
### TeX
texOut=src/tex
# Presentation inputs
&presConf=src/slideConf.yml 
&presInp=src/md/slides
# Common Parameters
paraPres=--standalone -f markdown --highlight-style kate --slide-level 2
htmlParaPres=--mathjax $(paraPres)
htmlParaDoc= $(htmlParaPres) --filter src/filters/panfluteInc.py --filter src/filters/panfHeaderList.py


## TeX
# : rootConf.yml README.md |> $(pandocBinary) --pdf-engine=xelatex --from markdown --template eisvogel -N --filter pandoc-eqnos --filter pandoc-fignos -f markdown %f -o %o --highlight-style kate |> src/tex/docu.tex
# : src/tex/docu.tex |> latexmk -f %f -r src/tex/.latexmkrc -outdir=doc -silent && latexmk -c %f -r src/tex/.latexmkrc -outdir=doc -silent |> docs/%B.pdf

# The presentations

## HTML
: &(presConf) &(presInp)/*.md |> \
  $(pandocBinary) -t revealjs $(htmlParaPres) %f -o %o \
  -V theme=black \
  |> $(htmlPresOut)/testReveal.html
: &(presConf) &(presInp)/*.md |> \
  $(pandocBinary) -t slidy $(htmlParaPres) %f -o %o\
  |> $(htmlPresOut)/testSlidy.html
: &(presConf) &(presInp)/*.md |> \
  $(pandocBinary) -t slideous $(htmlParaPres) %f -o %o\
  |> $(htmlPresOut)/testSlideous.html
: &(presConf) &(presInp)/*.md |> \
  $(pandocBinary) -t dzslides $(htmlParaPres) %f -o %o\
  |> $(htmlPresOut)/testDZ.html
: &(presConf) &(presInp)/*.md |> \
  $(pandocBinary) -t s5 $(htmlParaPres) %f -o %o\
  |> $(htmlPresOut)/testS5.html

## TeX
: &(presConf) &(presInp)/*.md |> \
  $(pandocBinary) -t beamer $(paraPres) %f -o %o \
  |> $(texOut)/testPres.tex
: $(texOut)/testPres.tex |> \
  latexmk %f -r src/tex/.latexmkrc -outdir=$(beamerOut) -silent && \
  latexmk -c %f -r src/tex/.latexmkrc -outdir=$(beamerOut) -silent \
  |> $(beamerOut)/%B.pdf


# Docs

## html

### css
: src/scss/main.scss |> sassc %f %o |> docs/css/zenYoda.css

### JS
: src/js/sideNav.js |> mkdir -p docs/js && cp %f docs/js/main.js |> docs/js/main.js

### html
#### Copy Dist
: $(beamerOut)/*.pdf $(htmlPresOut)/*.html \
|> cp -r dist/pres docs/ |> docs/pres/html/testReveal.html docs/pres/html/testSlidy.html \
docs/pres/html/testSlideous.html docs/pres/html/testDZ.html docs/pres/html/testS5.html \
docs/pres/beamer/testPres.pdf

#### Make Site
: src/docuConf.yml src/md/docu/docu.md \
| docs/css/zenYoda.css docs/js/main.js \
|> $(pandocBinary) -t html5 $(htmlParaDoc) %f -o %o \
|> docs/index.html

#### Deploy Site
# export DEPLOY
# ifeq (${DEPLOY},y)
# : docs/index.html \
# | docs/pres/html/*.html docs/css/*.css docs/js/*.js docs/pres/beamer/*.pdf \
# |> surge docs zenyoda.surge.sh |>
# endif

# export FOO
# ifeq (${FOO},y)
# : |> echo myFOO=$(FOO) envFOO=${FOO} > %o |> foo.txt
# endif